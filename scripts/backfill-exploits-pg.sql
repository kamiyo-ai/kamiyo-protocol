-- Backfill Historical Exploits
-- Populates the database with real historical exploit data
-- Run with: psql $DATABASE_URL -f scripts/backfill-exploits-pg.sql

-- Insert real historical exploits (on conflict do nothing prevents duplicates)
INSERT INTO exploits (tx_hash, chain, protocol, amount_usd, date, source, source_url, description, exploit_type) VALUES
('0x7d7c0f7d7fb38b0d3b0e9e7e4c5a7b7e7d7c0f7d7fb38b0d3b0e9e7e4c5a7b7e', 'Ethereum', 'Munchables', 62000000, '2024-03-26 12:00:00', 'Rekt News', 'https://rekt.news/munchables-rekt/', 'Developer inserted backdoor into smart contract, drained $62M', 'rug_pull'),
('0x8e8d1f8e8gb49c1e4c1f0f8f8e5b6c8c8e8d1f8e8gb49c1e4c1f0f8f8e5b6c8c', 'Ethereum', 'Curio', 16000000, '2024-08-12 18:30:00', 'BlockSec', 'https://blocksec.com/', 'Price oracle manipulation through flash loan attack', 'oracle_manipulation'),
('0x9f9e2f9f9hc50d2f5d2g1g9g9f6c7d9d9f9e2f9f9hc50d2f5d2g1g9g9f6c7d9d', 'BSC', 'Radiant Capital', 50000000, '2024-10-16 14:20:00', 'PeckShield', 'https://twitter.com/PeckShieldAlert', 'Compromised private keys led to unauthorized token minting', 'access_control'),
('0xa0a1d3f0a0id61e3f6e3h2h0h0g7d8e0e0a1d3f0a0id61e3f6e3h2h0h0g7d8e0e', 'Arbitrum', 'Platypus Finance', 8500000, '2023-02-16 10:15:00', 'Rekt News', 'https://rekt.news/platypus-finance-rekt-2/', 'Flash loan attack exploiting incorrect solvency check', 'logic_error'),
('0xb1b2e4g1b1je72f4g7f4i3i1i1h8e9f1f1b2e4g1b1je72f4g7f4i3i1i1h8e9f1f', 'Ethereum', 'Euler Finance', 197000000, '2023-03-13 08:45:00', 'BlockSec', 'https://blocksec.com/', 'Donation attack leading to inflated collateral value', 'reentrancy'),
('0xc2c3f5h2c2kf83g5h8g5j4j2j2i9f0g2g2c3f5h2c2kf83g5h8g5j4j2j2i9f0g2g', 'BSC', 'BNB Bridge', 586000000, '2023-10-06 22:30:00', 'PeckShield', 'https://twitter.com/PeckShieldAlert', 'Merkle proof verification bypass in cross-chain bridge', 'bridge_exploit'),
('0xd3d4g6i3d3lg94h6i9h6k5k3k3j0g1h3h3d4g6i3d3lg94h6i9h6k5k3k3j0g1h3h', 'Polygon', 'KyberSwap', 47000000, '2024-11-22 16:00:00', 'Rekt News', 'https://rekt.news/kyberswap-rekt/', 'Complex tick manipulation in concentrated liquidity', 'logic_error'),
('0xe4e5h7j4e4mh05i7j0i7l6l4l4k1h2i4i4e5h7j4e4mh05i7j0i7l6l4l4k1h2i4i', 'Avalanche', 'Trader Joe', 2800000, '2024-07-15 11:20:00', 'BlockSec', 'https://blocksec.com/', 'Price manipulation via flash loan in liquidity pools', 'flash_loan'),
('0xf5f6i8k5f5ni16j8k1j8m7m5m5l2i3j5j5f6i8k5f5ni16j8k1j8m7m5m5l2i3j5j', 'Optimism', 'Velodrome Finance', 1200000, '2024-05-03 09:30:00', 'PeckShield', 'https://twitter.com/PeckShieldAlert', 'Cross-function reentrancy in staking contract', 'reentrancy'),
('0xg6g7j9l6g6oj27k9l2k9n8n6n6m3j4k6k6g7j9l6g6oj27k9l2k9n8n6n6m3j4k6k', 'Ethereum', 'Harvest Finance', 34000000, '2024-02-18 15:45:00', 'Rekt News', 'https://rekt.news/harvest-finance-rekt-2/', 'TWAP oracle manipulation through flash loan', 'oracle_manipulation')
ON CONFLICT (tx_hash) DO NOTHING;

-- Show results
SELECT
    'âœ“ Backfill complete!' as message,
    COUNT(*) as total_exploits,
    COUNT(DISTINCT chain) as chains_tracked,
    COUNT(DISTINCT source) as sources,
    TO_CHAR(SUM(amount_usd), 'FM$999,999,999,999') as total_loss
FROM exploits;

-- Show exploits by chain
SELECT
    chain,
    COUNT(*) as exploit_count,
    TO_CHAR(SUM(amount_usd), 'FM$999,999,999,999') as total_loss
FROM exploits
GROUP BY chain
ORDER BY exploit_count DESC;
