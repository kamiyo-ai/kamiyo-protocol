#!/usr/bin/env python3
"""
Delete test exploit entry from database
"""
import os
import sys
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from database import get_db

def delete_test_exploit():
    """Delete the test protocol entry from exploits table"""

    db = get_db()

    try:
        # Delete only the test entry
        query = """
            DELETE FROM exploits
            WHERE id = 1
            AND protocol = 'Test Protocol'
            AND source = 'test'
            RETURNING id, protocol, source
        """

        result = db.execute_with_retry(query, readonly=False)

        if result:
            deleted = result[0]
            print(f"✅ Deleted test exploit:")
            print(f"   ID: {deleted[0]}")
            print(f"   Protocol: {deleted[1]}")
            print(f"   Source: {deleted[2]}")
        else:
            print("ℹ️  No test exploit found (may have already been deleted)")

    except Exception as e:
        print(f"❌ Error deleting test exploit: {e}")
        sys.exit(1)

if __name__ == '__main__':
    delete_test_exploit()
