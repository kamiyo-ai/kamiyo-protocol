// SPDX-License-Identifier: MIT
pragma solidity ^0.8.24;

import "forge-std/Script.sol";
import "../src/AgentProxy.sol";
import "../src/ReputationMirror.sol";
import "../src/SwarmSimulator.sol";

contract DeployKamiyo is Script {
    function run() external {
        uint256 pk = vm.envUint("PRIVATE_KEY");
        address admin = vm.addr(pk);

        vm.startBroadcast(pk);

        AgentProxy agentImpl = new AgentProxy();
        ReputationMirror mirror = new ReputationMirror(admin);
        SwarmSimulator swarm = new SwarmSimulator(admin);

        // VK from circuits/build/verification_key.json
        uint256[2] memory alpha = [
            uint256(20491192805390485299153009773594534940189261866228447918068658471970481763042),
            uint256(9383485363053290200918347156157836566562967994039712273449902621266178545958)
        ];
        uint256[2][2] memory beta = [
            [uint256(6375614351688725206403948262868962793625744043794305715222011528459656738731),
             uint256(4252822878758300859123897981450591353533073413197771768651442665752259397132)],
            [uint256(10505242626370262277552901082094356697409835680220590971873171140371331206856),
             uint256(21847035105528745403288232691147584728191162732299865338377159692350059136679)]
        ];
        uint256[2][2] memory gamma = [
            [uint256(10857046999023057135944570762232829481370756359578518086990519993285655852781),
             uint256(11559732032986387107991004021392285783925812861821192530917403151452391805634)],
            [uint256(8495653923123431417604973247489272438418190587263600148770280649306958101930),
             uint256(4082367875863433681332203403145435568316851327593401208105741076214120093531)]
        ];
        uint256[2][2] memory delta = [
            [uint256(3456636529185606053107739873835985046597186147383230720313535446150126387458),
             uint256(7451528827278889190622028381235300422999417255796052079525515926496988031710)],
            [uint256(11189200026782971667803994087145664908807656960426162797261528015105963069987),
             uint256(13921154161518599605273043339889826082715552312785847109084066197607831813667)]
        ];

        uint256[2][] memory ic = new uint256[2][](4);
        ic[0] = [uint256(2396978939873478575542114843733255533357175120249200425459579784145006990972),
                 uint256(4903330828808116133633305803672574707696807145774248236286608828648478229884)];
        ic[1] = [uint256(4238901246863406256923114381783303792468355213788231192070525290590713947526),
                 uint256(16182095431674564802101366772658486408136202431247369781232305541175382763017)];
        ic[2] = [uint256(14744342006682892777810594587849721959556323463744764259943539549735420764324),
                 uint256(20039585236037015187244931290998467470280497701283545688338467902216324156434)];
        ic[3] = [uint256(340445705329140611162532834233476908935804511932975324417363130375378184340),
                 uint256(12777221331215229378054094986310675917699538321960818263118719600859091739872)];

        mirror.setVerificationKey(alpha, beta, gamma, delta, ic);

        vm.stopBroadcast();

        console.log("AgentProxy impl:", address(agentImpl));
        console.log("ReputationMirror:", address(mirror));
        console.log("SwarmSimulator:", address(swarm));
    }
}
