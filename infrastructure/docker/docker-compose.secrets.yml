# docker-compose.secrets.yml
# Docker secrets configuration overlay
# Use with: docker-compose -f docker-compose.yml -f docker-compose.secrets.yml up

version: '3.8'

secrets:
  # Database secrets
  db_password:
    file: ./secrets/db_password.txt

  # Application secrets
  jwt_secret:
    file: ./secrets/jwt_secret.txt

  nextauth_secret:
    file: ./secrets/nextauth_secret.txt

  # Payment integration
  stripe_secret:
    file: ./secrets/stripe_secret.txt

  stripe_webhook_secret:
    file: ./secrets/stripe_webhook_secret.txt

  # Optional: OAuth
  google_client_secret:
    file: ./secrets/google_client_secret.txt

  # Optional: Monitoring
  sentry_dsn:
    file: ./secrets/sentry_dsn.txt

services:
  # PostgreSQL with secrets
  postgres:
    secrets:
      - db_password
    environment:
      - POSTGRES_PASSWORD_FILE=/run/secrets/db_password

  # API service with secrets
  api:
    secrets:
      - db_password
      - jwt_secret
      - stripe_secret
      - stripe_webhook_secret
    environment:
      # Use secrets from /run/secrets/
      - JWT_SECRET_FILE=/run/secrets/jwt_secret
      - STRIPE_SECRET_FILE=/run/secrets/stripe_secret
      - STRIPE_WEBHOOK_SECRET_FILE=/run/secrets/stripe_webhook_secret

  # Frontend with secrets
  frontend:
    secrets:
      - nextauth_secret
      - google_client_secret
      - sentry_dsn
      - stripe_secret
    environment:
      - NEXTAUTH_SECRET_FILE=/run/secrets/nextauth_secret
      - GOOGLE_CLIENT_SECRET_FILE=/run/secrets/google_client_secret
      - SENTRY_DSN_FILE=/run/secrets/sentry_dsn
